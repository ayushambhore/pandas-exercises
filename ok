from reportlab.pdfgen import canvas
from reportlab.lib.units import mm
from PyPDF2 import PdfReader, PdfWriter
from PyPDF2.generic import RectangleObject
from PyPDF2 import Transformation

class PDFCreator:
    def __init__(self):
        self.page_width = 437 * mm
        self.page_height = 330 * mm
        self.blank_pdf_path = "blank.pdf"
        self.final_pdf_path = "output.pdf"

    def create_blank_pdf(self, filename, num_pages):
        """Create a blank PDF with given number of pages."""
        c = canvas.Canvas(filename, pagesize=(self.page_width, self.page_height))
        for _ in range(num_pages):
            c.showPage()
        c.save()
        print(f"Blank PDF with {num_pages} pages created: {filename}")

    def text2pdf(self, txt_filepath):
        try:
            # Step 1: Create blank PDF
            self.create_blank_pdf(self.blank_pdf_path, num_pages=4)

            # Step 2: Read the blank PDF
            reader = PdfReader(self.blank_pdf_path)
            writer = PdfWriter()

            # Step 3: Read the text file
            with open(txt_filepath, 'r', encoding='utf-8') as txt_file:
                lines = txt_file.readlines()

            # Step 4: Define starting coordinates
            margin_x = 40  # from left
            start_y = self.page_height - 50  # from top
            line_spacing = 20  # space between lines

            page_index = 0
            current_y = start_y

            # Step 5: Start writing line-by-line
            page = reader.pages[page_index]
            for line in lines:
                line = line.strip()
                if not line:
                    continue  # skip empty lines

                # If not enough space, go to next page
                if current_y <= 50:
                    writer.add_page(page)
                    page_index += 1
                    if page_index >= len(reader.pages):
                        print("Ran out of blank pages!")
                        break
                    page = reader.pages[page_index]
                    current_y = start_y

                # Add text to page
                page.add_text(
                    text=line,
                    location=(margin_x, current_y),
                    font="Helvetica",
                    size=12
                )

                current_y -= line_spacing

            # Add the last modified page
            writer.add_page(page)

            # Step 6: Save final PDF
            with open(self.final_pdf_path, "wb") as f_out:
                writer.write(f_out)

            print("Successfully created PDF with text!")

        except Exception as e:
            print(f"Error: {e}")

if __name__ == "__main__":
    pdf_creator = PDFCreator()
    txt_filepath = "/home/aayush.ambhore@gripunedomain.com/Desktop/Files/Tasks/Appendix.txt"
    pdf_creator.text2pdf(txt_filepath)


